/*
 * KDP Formatter POC Stylesheet
 * KDP-compatible CSS for print-on-demand formatting
 */

/* Import fonts - adjust paths as needed for local fonts */
@import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap');

/* Use local fonts if available, fallback to web fonts */
@font-face {
    font-family: 'Bookerly';
    src: local('Bookerly Regular'), local('Bookerly-Regular'),
         url('fonts/Bookerly-Regular.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'Bookerly';
    src: local('Bookerly Italic'), local('Bookerly-Italic'),
         url('fonts/Bookerly-Italic.ttf') format('truetype');
    font-weight: normal;
    font-style: italic;
}

@font-face {
    font-family: 'Bookerly';
    src: local('Bookerly Bold'), local('Bookerly-Bold'),
         url('fonts/Bookerly-Bold.ttf') format('truetype');
    font-weight: bold;
    font-style: normal;
}

/* Page setup for KDP - Following KDP Guidelines */
/* 6x9 trim size - 76 pages needs gutter ≥ 0.375", outside ≥ 0.25" */
/* Using larger margins to ensure text stays within bounds */
@page {
    size: 6in 9in;
    margin: 0.75in 0.75in 0.75in 0.85in;  /* top right bottom left (gutter) */
}

/* Left-hand pages (verso) - gutter is on RIGHT side */
@page :left {
    margin: 0.75in 0.85in 0.75in 0.75in;
}

/* Right-hand pages (recto) - gutter is on LEFT side */
@page :right {
    margin: 0.75in 0.75in 0.75in 0.85in;
}

/* Page breaks */
/* page-break-before: always ensures each chapter starts on a new page per KDP standards */
.chapter {
    page-break-before: always;  /* KDP requirement: chapters must start on new pages */
}

/* Body text - Following KDP Guidelines */
body {
    font-family: 'Georgia', 'Times New Roman', serif;
    font-size: 10.5pt;
    line-height: 1.45;
    color: #000;
    margin: 0;
    padding: 0;
    text-align: left;
    hyphens: none;
    -webkit-hyphens: none;
    -ms-hyphens: none;
    word-break: normal;
    overflow-wrap: normal;
    orphans: 3;
    widows: 3;
}

/* Headings */
h1, h2, h3 {
    font-family: 'Bookerly', 'Libre Baskerville', 'Crimson Text', serif;
    font-weight: bold;
    color: #000;
    text-align: center;
    page-break-after: avoid;
}

h1 {
    font-size: 18pt;
    line-height: 1.2;
    margin-top: 2em;
    margin-bottom: 1.5em;
}

h2 {
    font-size: 14pt;
    line-height: 1.3;
    margin-top: 1.5em;
    margin-bottom: 1em;
}

h3 {
    font-size: 12pt;
    line-height: 1.3;
    margin-top: 1.2em;
    margin-bottom: 0.8em;
}

/* Chapter titles */
.chapter-title {
    font-size: 18pt;
    font-weight: bold;
    margin-top: 2em;
    margin-bottom: 1.5em;
    text-align: center;
    page-break-after: avoid;
}

/* Paragraphs */
/* Block-style formatting: no indentation, spacing between paragraphs */
/* This modern style is accepted by KDP and works well for letter-format books */
p {
    margin: 0 0 0.8em 0;
    text-indent: 0;  /* No indentation - clean block style */
    text-align: left;
    line-height: 1.5;
    orphans: 3;  /* KDP requirement: minimum 3 lines prevents single-line orphans */
    widows: 3;   /* KDP requirement: minimum 3 lines prevents single-line widows */
}

/* Bullet lists parsed from inline bullet markers */
ul.bullet-list {
    margin: 0 0 0.8em 1.2em;
    padding-left: 1em;
    list-style-type: disc;
}

ul.bullet-list li {
    margin: 0 0 0.4em 0;
}

/* Modern paragraph spacing (optional, not traditional KDP) */
body.use-paragraph-spacing p {
    margin-bottom: 0.5em;
}

body.use-paragraph-spacing p.first-para,
body.use-paragraph-spacing .chapter > .chapter-title + p,
body.use-paragraph-spacing .chapter > h1 + p,
body.use-paragraph-spacing .chapter > h2 + p,
body.use-paragraph-spacing .chapter > h3 + p,
body.use-paragraph-spacing .front-matter p,
body.use-paragraph-spacing .back-matter p {
    margin-bottom: 0.5em;
}

/* First paragraph after headings: no indent (KDP standard)
 * Use higher specificity to override general p rule
 * KDP books use indentation without spacing - first paragraphs after headings have no indent */
.chapter p.first-para,
.chapter > .chapter-title + p,
.chapter > h1 + p,
.chapter > h2 + p,
.chapter > h3 + p {
    text-indent: 0 !important;
}

/* Disable indentation entirely (optional, for non-KDP use) */
body.no-indent p {
    text-indent: 0 !important;
}

/* Blockquotes */
/* page-break-inside: avoid prevents blockquotes from breaking awkwardly across pages */
blockquote {
    margin: 1em 1.5em;
    padding: 0.5em 1em;
    font-style: italic;
    border-left: 3px solid #ccc;
    background-color: #f9f9f9;
    page-break-inside: avoid;  /* Prevent awkward breaks within blockquotes */
}

blockquote p { text-indent: 0; }

/* Front and back matter */
.front-matter, .back-matter {
    text-align: center;
}

.front-matter p, .back-matter p {
    text-indent: 0;
    margin: 0.5em 0;
}

/* Chapter subtitle (e.g., "Disconnected (My first signs of FND)") */
p.subtitle {
    text-indent: 0;
    margin: 0 0 1em 0;
    font-style: italic;
    font-size: 1em;
}

/* Letter greeting (e.g., "Dear Me,") */
p.greeting {
    text-indent: 0;
    margin: 1.2em 0 0.8em 0;
    font-style: normal;
}

/* Letter closing/signature */
p.closing {
    text-indent: 0;
    margin: 1.5em 0 0.5em 0;
}

p.signature {
    text-indent: 0;
    margin: 1.5em 0 0.5em 0;
    text-align: right;
    font-style: italic;
}

/* Emphasis text (centered, bold) */
p.emphasis {
    text-indent: 0;
    margin: 1em 0;
    text-align: center;
    font-weight: bold;
    font-style: italic;
}

/* Special styling */
.emphasis {
    font-style: italic;
}

.strong {
    font-weight: bold;
}

/* Drop caps for chapter starts (optional - controlled by .use-drop-caps class) */
.chapter.use-drop-caps p:first-of-type::first-letter {
    float: left;
    font-size: 2.3em;  /* Reduced for better proportions and less overlap */
    line-height: 1.0;  /* Increased to prevent overlap with line below */
    margin: 0.05em 0.15em 0 0;  /* Better spacing for text flow */
    padding-top: 0.05em;  /* Lift drop cap slightly for better alignment */
    font-weight: bold;
}

/* Ensure proper spacing */
* {
    box-sizing: border-box;
}

/* Print-specific optimizations */
/* These rules reinforce KDP compliance during PDF generation and printing */
@media print {
    body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        orphans: 3;  /* KDP requirement: prevent single-line orphans in print */
        widows: 3;   /* KDP requirement: prevent single-line widows in print */
    }

    /* Ensure no unwanted page breaks */
    h1, h2, h3, .chapter-title {
        page-break-after: avoid;  /* Prevent headings from being widowed */
    }

    p { page-break-inside: avoid; }

    blockquote {
        page-break-inside: avoid;  /* Prevent blockquotes from breaking across pages */
    }
}
